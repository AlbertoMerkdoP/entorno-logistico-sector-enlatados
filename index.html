<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entorno Logístico | Informe Técnico</title>
    
    <!-- Fuentes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Space+Grotesk:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Space Grotesk', 'sans-serif'],
                    },
                    colors: {
                        'brand-blue': '#2997ff',
                        'brand-red': '#ff453a',
                        'brand-gold': '#ffd700',
                        'glass-bg': 'rgba(5, 5, 8, 0.95)',
                        'glass-border': 'rgba(255, 255, 255, 0.2)',
                    }
                }
            }
        }
    </script>

    <style>
        body { 
            margin: 0; 
            background-color: #050505; 
            color: #f5f5f7; 
            overflow-x: hidden; 
        }
        
        #canvas-container {
            position: fixed; inset: 0; z-index: 0;
            pointer-events: none;
        }

        /* --- PANELES --- */
        .content-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid var(--glass-border);
            border-left: 3px solid var(--accent-color, #2997ff);
            padding: 2rem;
            border-radius: 0 1rem 1rem 0;
            width: 45%; 
            max-width: 500px;
            opacity: 0; 
            transform: translateY(20px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8);
        }
        
        .panel-right {
            margin-left: auto; margin-right: 5%;
            border-radius: 1rem 0 0 1rem;
            border-left: 1px solid var(--glass-border);
            border-right: 3px solid var(--accent-color, #2997ff);
            text-align: right;
        }

        .panel-left { margin-right: auto; margin-left: 5%; }

        .panel-full {
            width: 90%; max-width: 1200px;
            margin: 0 auto;
            display: flex; gap: 2rem;
            border-radius: 1rem;
            border-left: 1px solid var(--glass-border);
            border-right: 1px solid var(--glass-border);
            border-top: 3px solid var(--accent-color, #2997ff);
            flex-direction: row;
            align-items: stretch;
            min-height: 80vh; 
            height: auto;
            padding-bottom: 2rem;
        }

        /* Panel Centrado para Servicio al Cliente */
        .panel-center {
            width: 80%; max-width: 900px;
            margin: 0 auto;
            text-align: center;
            border-left: 1px solid var(--glass-border);
            border-right: 1px solid var(--glass-border);
            border-top: 3px solid var(--accent-color, #ffd700); /* Dorado */
            border-radius: 1rem;
        }

        @media (max-width: 1024px) {
            .panel-full { flex-direction: column; height: auto; }
        }

        h1, h2 { font-family: 'Space Grotesk', sans-serif; letter-spacing: -0.02em; line-height: 1.1; }
        p { font-family: 'Inter', sans-serif; line-height: 1.6; color: #d1d1d6; font-size: 0.95rem; }
        strong { color: #fff; font-weight: 600; }
        
        .kpi-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;
            margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1);
        }
        .kpi-item span:first-child { display: block; font-size: 0.7rem; text-transform: uppercase; color: #86868b; letter-spacing: 1px; margin-bottom: 4px; }
        .kpi-item span:last-child { display: block; font-size: 1.25rem; font-weight: 700; color: #fff; }

        .scroll-section {
            min-height: 100vh; 
            height: auto; 
            position: relative; z-index: 10;
            display: flex; align-items: center; padding: 2rem 0;
            pointer-events: none; 
        }
        .scroll-section > * { pointer-events: auto; }

        .nav-dots {
            position: fixed; left: 20px; top: 50%; transform: translateY(-50%);
            display: flex; flex-direction: column; gap: 15px; z-index: 50;
        }
        .dot {
            width: 6px; height: 6px; background: rgba(255,255,255,0.2); border-radius: 50%;
            transition: all 0.3s ease; cursor: pointer;
        }
        .dot.active { background: #2997ff; transform: scale(1.5); box-shadow: 0 0 10px #2997ff; }

        .hud-line {
            height: 2px; width: 60px; margin: 20px 0;
            background: linear-gradient(90deg, currentColor, transparent);
        }
        .panel-right .hud-line { background: linear-gradient(-90deg, currentColor, transparent); margin-left: auto; }
        .panel-center .hud-line { background: linear-gradient(90deg, transparent, currentColor, transparent); margin: 20px auto; }

        /* --- ESTILOS MATRIZ RIESGO --- */
        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 4px;
            aspect-ratio: 1/1;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }
        .heat-cell {
            border-radius: 4px;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.8rem; font-weight: bold; color: rgba(0,0,0,0.6);
            transition: all 0.2s;
            position: relative;
        }
        .heat-cell:hover { transform: scale(1.1); z-index: 10; box-shadow: 0 0 15px rgba(0,0,0,0.8); color: #fff; cursor: pointer; border: 1px solid white; }
        
        .risk-list {
            max-height: 70vh;
            overflow-y: auto;
            padding-right: 10px;
            flex: 1;
        }
        .risk-item {
            background: rgba(255,255,255,0.03);
            border-left: 4px solid transparent;
            border-radius: 4px;
            padding: 12px;
            margin-bottom: 10px;
            transition: background 0.2s;
        }
        .risk-item:hover { background: rgba(255,255,255,0.08); }
        .risk-badge { font-size: 0.6rem; padding: 2px 6px; border-radius: 4px; font-weight: bold; text-transform: uppercase; border: 1px solid currentColor; }
        
        .risk-list::-webkit-scrollbar { width: 6px; }
        .risk-list::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
        .risk-list::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }

        /* --- TARJETAS SERVICIO AL CLIENTE --- */
        .service-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-top: 2rem;
            text-align: left;
        }
        @media(max-width: 768px) { .service-grid { grid-template-columns: 1fr; } }
        
        .service-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 1.5rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }
        .service-card:hover {
            background: rgba(255,215,0, 0.1);
            border-color: rgba(255,215,0, 0.4);
            transform: translateY(-5px);
        }
        .service-title { font-family: 'Space Grotesk', sans-serif; font-weight: 700; color: #fff; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; }
        .service-icon { width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; background: rgba(255,215,0, 0.2); color: #ffd700; border-radius: 50%; font-size: 12px; font-weight: bold; }

        #loader { transition: opacity 0.8s ease; }
    </style>
</head>
<body>

    <div id="loader" class="fixed inset-0 bg-black z-50 flex flex-col items-center justify-center">
        <div class="font-display font-bold text-3xl md:text-5xl tracking-tighter text-white mb-4 text-center px-4 leading-tight">ENTORNO LOGÍSTICO <br><span class="text-brand-blue">DEL SECTOR DE ENLATADOS</span></div>
        <div class="mt-4 text-xs font-mono text-gray-500 tracking-widest uppercase">Cargando Recursos...</div>
    </div>

    <div id="canvas-container"></div>

    <div class="fixed top-0 w-full p-6 z-40 flex justify-between items-start pointer-events-none mix-blend-plus-lighter">
        <div>
            <div class="text-[10px] font-mono text-brand-blue mb-1 border border-brand-blue/30 inline-block px-2 py-0.5 rounded backdrop-blur-md uppercase">Informe Noviembre 2025</div>
            <div class="text-xl font-bold text-white tracking-tight">Entorno logístico de enlatados</div>
        </div>
        <div class="hidden md:block text-right">
             <div class="text-[10px] font-mono text-gray-500 mb-1">ESTADO</div>
             <div class="flex items-center justify-end gap-2">
                 <span id="status-indicator" class="w-2 h-2 bg-brand-blue rounded-full animate-pulse shadow-[0_0_10px_#2997ff]"></span>
                 <span id="status-text" class="text-xs font-bold text-white tracking-wider">ONLINE</span>
             </div>
        </div>
    </div>

    <div class="nav-dots">
        <div class="dot active" onclick="scrollToSec(0)"></div>
        <div class="dot" onclick="scrollToSec(1)"></div>
        <div class="dot" onclick="scrollToSec(2)"></div>
        <div class="dot" onclick="scrollToSec(3)"></div>
        <div class="dot" onclick="scrollToSec(4)"></div>
        <div class="dot" onclick="scrollToSec(5)"></div>
        <div class="dot" onclick="scrollToSec(6)"></div>
        <div class="dot" onclick="scrollToSec(7)"></div>
    </div>

    <div id="scroll-wrapper">
        
        <!-- 0. INTRODUCCIÓN -->
        <section class="scroll-section" id="sec-0">
            <div class="content-panel panel-right" style="--accent-color: #2997ff;">
                <span class="text-xs font-mono text-brand-blue tracking-widest uppercase mb-2 block">Introducción</span>
                <h1 class="text-4xl md:text-5xl font-bold text-white mb-4">Entorno Logístico del Atún Enlatado.</h1>
                <div class="hud-line text-brand-blue"></div>
                <p class="text-lg">
                    Una revisión técnica del producto, sus características críticas y los procesos logísticos que permiten su producción y distribución.
                </p>
                <div class="mt-8 pt-6 border-t border-white/10 flex justify-between items-end">
                     <div>
                        <div class="text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-2">Autores</div>
                        <ul class="text-xs text-white space-y-1 font-medium">
                            <li>Alberto Mercado</li>
                            <li>Marolin Pumarejo</li>
                            <li>Juan Quintero</li>
                        </ul>
                     </div>
                     <div class="text-right">
                        <div class="text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-2">Institución</div>
                        <div class="text-xs text-white font-medium">Universidad del Atlántico</div>
                     </div>
                </div>
            </div>
        </section>

        <!-- 1. PRODUCTO -->
        <section class="scroll-section" id="sec-1">
            <div class="content-panel panel-left" style="--accent-color: #32d74b;">
                <span class="text-xs font-mono text-green-400 tracking-widest uppercase mb-2 block">Caracterización</span>
                <h2 class="text-4xl font-bold text-white mb-2">Transparencia Total</h2>
                <p class="text-xs text-green-400 font-mono mb-4">EL PRODUCTO DEFINE LA LOGÍSTICA</p>
                <div class="hud-line text-green-400"></div>
                
                <p class="mb-4 text-sm leading-relaxed">
                    Combina biología e ingeniería térmica. El envase de hojalata protege especies clave como el <strong>Skipjack</strong> (rotación masiva) y el <strong>Yellowfin</strong> (calidad) sin necesidad de refrigeración.
                </p>

                <div class="bg-white/5 rounded p-3 mb-4 border border-white/10">
                    <h3 class="text-[10px] font-bold text-white mb-2 uppercase tracking-wider opacity-70">Propiedades Fisicoquímicas</h3>
                    <ul class="text-xs text-gray-300 space-y-1">
                        <li class="flex justify-between"><span>pH Natural:</span> <strong class="text-white">5.8–6.3</strong></li>
                        <li class="flex justify-between"><span>Proteína:</span> <strong class="text-white">20–30%</strong></li>
                        <li class="flex justify-between"><span>Riesgo Crítico:</span> <strong class="text-red-400">Histamina</strong></li>
                    </ul>
                </div>

                <div class="kpi-grid">
                    <div class="kpi-item"><span>Vida Útil</span><span>2-5 Años</span></div>
                    <div class="kpi-item"><span>Temp. Ideal</span><span>10-30 °C</span></div>
                    <div class="kpi-item"><span>Humedad</span><span>< 75%</span></div>
                    <div class="kpi-item"><span>Envase</span><span>Hojalata</span></div>
                </div>
            </div>
        </section>

        <!-- 2. RIESGO HISTAMINA -->
        <section class="scroll-section" id="sec-2">
            <div class="content-panel panel-right" style="--accent-color: #ff453a;">
                <span class="text-xs font-mono text-red-500 tracking-widest uppercase mb-2 block">Punto Crítico</span>
                <h2 class="text-4xl font-bold text-white mb-4">Control Térmico en Origen</h2>
                <div class="hud-line text-red-500"></div>
                
                <p class="mb-4 text-sm leading-relaxed">
                    La logística inicia antes del empaque. Si el atún pierde frío en captura o recepción, aparece la <strong>histamina</strong>, una toxina termoestable que ningún proceso posterior puede eliminar.
                </p>

                <div class="bg-red-900/20 border border-red-500/50 p-4 rounded-lg mb-4 flex items-start gap-3">
                    <div class="text-2xl">⚠️</div>
                    <div>
                        <p class="text-red-200 text-xs font-bold mb-1 uppercase tracking-wide">Umbral Crítico</p>
                        <p class="text-white text-xs leading-relaxed m-0">
                            Exposición <strong>>4 °C</strong> por periodos prolongados = Lote irrecuperable (Residuo Peligroso).
                        </p>
                    </div>
                </div>
                
                <p class="text-xs text-gray-400 italic">
                    Todo lo que ocurre después (esterilización, enlatado, almacenamiento) depende de mantener este punto bajo control.
                </p>
            </div>
        </section>

        <!-- 3. ALMACENAMIENTO FEFO -->
        <section class="scroll-section" id="sec-3">
            <div class="content-panel panel-left" style="--accent-color: #ff9f0a;">
                <span class="text-xs font-mono text-orange-400 tracking-widest uppercase mb-2 block">Gestión de Inventario</span>
                <h2 class="text-4xl font-bold text-white mb-4">Estrategia FEFO</h2>
                <div class="hud-line text-orange-400"></div>
                
                <p class="mb-4 text-sm leading-relaxed">
                    Rotación estricta por <strong>FEFO</strong> (First Expired, First Out). El sector retail exige recibir lotes con <strong>75–80% de vida útil remanente</strong>, con una rotación promedio de ~60 días.
                </p>

                <div class="bg-white/5 rounded p-3 mb-4 border border-white/10">
                    <h3 class="text-[10px] font-bold text-white mb-2 uppercase tracking-wider opacity-70">Control Ambiental (Almacén)</h3>
                    <p class="text-xs text-gray-400 mb-2">Aunque es carga seca, es sensible a corrosión ("sudoración").</p>
                    <ul class="text-xs text-gray-300 space-y-1">
                        <li class="flex justify-between"><span>Humedad Relativa:</span> <strong class="text-orange-400">< 75%</strong></li>
                        <li class="flex justify-between"><span>Temperatura:</span> <strong class="text-white">10–30 °C</strong></li>
                        <li class="flex justify-between"><span>Ventilación:</span> <strong class="text-white">Uso de Pallets</strong></li>
                    </ul>
                </div>

                <div class="kpi-grid">
                    <div class="kpi-item"><span>Rotación Prom.</span><span>~60 Días</span></div>
                    <div class="kpi-item"><span>Vida Útil Retail</span><span>> 75%</span></div>
                </div>
            </div>
        </section>

        <!-- 4. TRANSPORTE -->
        <section class="scroll-section" id="sec-4">
            <div class="content-panel panel-right" style="--accent-color: #2997ff;">
                <span class="text-xs font-mono text-brand-blue tracking-widest uppercase mb-2 block">Distribución</span>
                <h2 class="text-4xl font-bold text-white mb-2">Ingeniería de Carga</h2>
                <div class="hud-line text-brand-blue"></div>
                
                <p class="mb-4 text-sm leading-relaxed">
                    Carga densa → el límite es el peso. Se estandariza en <strong>20’ Dry</strong> con un factor de estiba de <strong>1.60–1.68 m³/ton</strong>.
                </p>

                <div class="grid grid-cols-2 gap-3 mb-2">
                    <div class="bg-white/5 rounded p-2 border border-white/10">
                        <h3 class="text-[10px] font-bold text-blue-200 uppercase mb-1">Marítimo</h3>
                        <ul class="text-[9px] text-gray-300 space-y-1">
                            <li>• Riesgo: Condensación</li>
                            <li>• Uso de desecantes</li>
                            <li>• Revisión techo/piso</li>
                            <li>• Limpio y sin olores</li>
                        </ul>
                    </div>
                    <div class="bg-white/5 rounded p-2 border border-white/10">
                        <h3 class="text-[10px] font-bold text-blue-200 uppercase mb-1">Terrestre</h3>
                        <ul class="text-[9px] text-gray-300 space-y-1">
                            <li>• Camión cerrado</li>
                            <li>• Pallets asegurados</li>
                            <li>• Cero abolladuras</li>
                            <li>• Cero químicos</li>
                        </ul>
                    </div>
                </div>

                <div class="mt-2 p-2 bg-blue-900/20 border border-blue-500/30 rounded">
                    <p class="text-[10px] text-blue-200 text-center font-mono">
                        CLAVE OPERATIVA: <span class="text-white font-bold">Integridad del envase = Integridad del lote</span>
                    </p>
                </div>
            </div>
        </section>

        <!-- 5. SERVICIO AL CLIENTE (NUEVA SECCIÓN) -->
        <section class="scroll-section justify-center" id="sec-5">
            <div class="content-panel panel-center" style="--accent-color: #ffd700;">
                <span class="text-xs font-mono text-yellow-400 tracking-widest uppercase mb-2 block">Excelencia Operativa</span>
                <h2 class="text-4xl md:text-5xl font-bold text-white mb-4">El Pedido Perfecto</h2>
                <div class="hud-line text-yellow-400"></div>
                <p class="max-w-2xl mx-auto text-sm text-gray-300 mb-6">
                    En la industria del atún, entregar no es suficiente. Un pedido es perfecto solo si cumple simultáneamente con estos cuatro criterios logísticos:
                </p>

                <div class="service-grid">
                    <div class="service-card">
                        <div class="service-title"><span class="service-icon">1</span> A Tiempo</div>
                        <p class="text-[11px] text-gray-400">Ventanas estrictas de entrega. Un retraso afecta anaqueles y provoca pérdida inmediata de ventas.</p>
                    </div>
                    <div class="service-card">
                        <div class="service-title"><span class="service-icon">2</span> Completo</div>
                        <p class="text-[11px] text-gray-400">Cantidad exacta por referencia. Sin sustituciones, sin faltantes, sin quiebres de inventario.</p>
                    </div>
                    <div class="service-card">
                        <div class="service-title"><span class="service-icon">3</span> Sin Daños</div>
                        <p class="text-[11px] text-gray-400">Cero abolladuras, cero corrosión. La integridad del envase es la seguridad del producto.</p>
                    </div>
                    <div class="service-card">
                        <div class="service-title"><span class="service-icon">4</span> Documentación</div>
                        <p class="text-[11px] text-gray-400">Facturas, packing list y COA coinciden con el físico. Errores = Rechazo total.</p>
                    </div>
                </div>
                
                <div class="mt-6 text-xs text-yellow-500/80 font-mono border-t border-white/10 pt-4">
                    IMPACTO: Fallos = Devoluciones, Penalizaciones y Pérdida de espacio en Góndola.
                </div>
            </div>
        </section>

        <!-- 6. MATRIZ DE RIESGOS -->
        <section class="scroll-section justify-center" id="sec-6">
            <div class="content-panel panel-full" style="--accent-color: #bf5af2;">
                <!-- Columna Izquierda: Heatmap -->
                <div class="w-full lg:w-1/2 flex flex-col justify-center border-r border-white/10 pr-4">
                    <div class="flex justify-between items-center mb-6">
                        <span class="text-xs font-mono text-purple-400 uppercase tracking-widest">Matriz de Calor</span>
                        <div class="flex gap-2 text-[9px] text-gray-400">
                            <span class="flex items-center gap-1"><span class="w-2 h-2 bg-[#32d74b] rounded-full"></span>Bajo</span>
                            <span class="flex items-center gap-1"><span class="w-2 h-2 bg-[#ffd60a] rounded-full"></span>Medio</span>
                            <span class="flex items-center gap-1"><span class="w-2 h-2 bg-[#ff9f0a] rounded-full"></span>Alto</span>
                            <span class="flex items-center gap-1"><span class="w-2 h-2 bg-[#ff453a] rounded-full"></span>Critico</span>
                        </div>
                    </div>
                    
                    <div class="relative w-full flex justify-center">
                        <div class="absolute -left-4 top-1/2 -translate-y-1/2 -rotate-90 text-[10px] text-gray-500 tracking-widest font-bold">PROBABILIDAD</div>
                        <div class="heatmap-grid" id="risk-heatmap"></div>
                    </div>
                    <div class="text-center mt-3 text-[10px] text-gray-500 tracking-widest font-bold">IMPACTO</div>
                </div>

                <!-- Columna Derecha: Lista -->
                <div class="w-full lg:w-1/2 flex flex-col h-full pl-4">
                    <h3 class="text-xl font-bold text-white mb-4 font-display flex items-center justify-between">
                        Listado de Riesgos
                        <span class="text-xs bg-white/10 px-2 py-1 rounded text-gray-400">23 Total</span>
                    </h3>
                    <div class="risk-list" id="risk-list-container"></div>
                </div>
            </div>
        </section>

        <!-- 7. CIERRE -->
        <section class="scroll-section justify-center text-center" id="sec-7">
            <div class="content-panel" style="--accent-color: #ffd700; text-align: center; border-right: 3px solid #ffd700; border-left: 3px solid #ffd700; max-width: 700px; width: 80%; margin: 0 auto;">
                <span class="text-xs font-mono text-yellow-400 tracking-widest uppercase mb-2 block">Conclusión</span>
                <h2 class="text-4xl font-bold text-white mb-4">Logística Competitiva</h2>
                <div class="hud-line text-yellow-400 mx-auto"></div>
                <p class="mb-8">
                    La excelencia logística garantiza inocuidad, disponibilidad y calidad. El consumidor confía en la lata; la ingeniería asegura esa confianza.
                </p>
                <button onclick="window.scrollTo({top:0, behavior:'smooth'})" class="group relative px-8 py-3 bg-white/5 hover:bg-white/10 border border-white/20 rounded-full text-sm font-bold transition-all uppercase tracking-widest overflow-hidden">
                    <span class="relative z-10 group-hover:text-brand-blue transition-colors">Reiniciar</span>
                    <div class="absolute inset-0 bg-white/0 group-hover:bg-white/5 transition-colors"></div>
                </button>
            </div>
        </section>

    </div>

    <!-- Librerías -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <script>
        // --- DATOS RIESGOS (TEXTO EXACTO) ---
        const riskData = [
            { id: 1, name: "Escasez de materia prima (pescado, carne, vegetales)", desc: "Reducción de capacidad productiva y aumento de costos.", prob: 3, imp: 4, plan: "Contratos múltiples, proveedores internacionales, compras anticipadas." },
            { id: 2, name: "Fenómenos climáticos (El Niño / La Niña)", desc: "Reducción de pesca y afectación a cultivos.", prob: 4, imp: 4, plan: "Inventarios estratégicos, diversificación geográfica, pronósticos IDEAM/FAO." },
            { id: 3, name: "Variación del precio del acero para latas", desc: "Incremento del costo del empaque.", prob: 3, imp: 4, plan: "Acuerdos de precio, compras a largo plazo, materiales alternativos." },
            { id: 4, name: "Cambios regulatorios (INVIMA/Codex / FDA)", desc: "Ajustes obligatorios en BPM, etiquetado y procesos térmicos.", prob: 2, imp: 4, plan: "Auditorías internas, actualización HACCP, capacitación continua." },
            { id: 5, name: "Incremento del costo del combustible", desc: "Aumento del costo logístico y transporte.", prob: 3, imp: 3, plan: "Optimización de rutas, transporte consolidado." },
            { id: 6, name: "Interrupciones logísticas (paros, bloqueos, puertos)", desc: "Retraso en distribución e importación de insumos.", prob: 3, imp: 4, plan: "Rutas alternas, operadores múltiples, uso de puertos secundarios." },
            { id: 7, name: "Cortes de energía en planta", desc: "Paro de producción y riesgo sanitario.", prob: 2, imp: 5, plan: "Plantas eléctricas, mantenimiento preventivo, priorización de líneas críticas." },
            { id: 8, name: "Contaminación microbiológica (Clostridium, Listeria)", desc: "Riesgo de recall y sanciones.", prob: 1, imp: 5, plan: "HACCP, muestreo intensivo, trazabilidad completa." },
            { id: 9, name: "Dependencia de un único proveedor de envases", desc: "Paro total de producción. Incremento del costo de insumos importados.", prob: 2, imp: 5, plan: "Homologación de proveedores, contratos duales. Coberturas cambiarias, compras anticipadas." },
            { id: 10, name: "Fluctuación del tipo de cambio", desc: "Disminución del consumo de productos premium.", prob: 2, imp: 3, plan: "Portafolio económico, promociones." },
            { id: 11, name: "Crisis económicas", desc: "Disminución en demanda de enlatados tradicionales.", prob: 2, imp: 3, plan: "Innovación de productos, reformulación, campañas educativas." },
            { id: 12, name: "Cambios en preferencias del consumidor", desc: "Disminución en demanda de enlatados tradicionales.", prob: 2, imp: 3, plan: "Innovación de productos, reformulación, campañas educativas." },
            { id: 13, name: "Requisitos ambientales más estrictos", desc: "Inversiones en sostenibilidad y reciclaje.", prob: 2, imp: 4, plan: "Envases reciclables, certificaciones ambientales." },
            { id: 14, name: "Escasez de aceites vegetales", desc: "Aumento del costo de producción.", prob: 3, imp: 3, plan: "Diversificación de proveedores del exterior, contratos futuros." },
            { id: 15, name: "Riesgos geopolíticos (guerras, sanciones)", desc: "Aumento de precios globales y escasez.", prob: 2, imp: 4, plan: "Buscar mercados alternos, acuerdos plurianuales." },
            { id: 16, name: "Error en el control de calidad", desc: "Producto defectuoso llega al mercado; riesgo de recall.", prob: 3, imp: 4, plan: "Capacitación, doble verificación, sensores de inspección." },
            { id: 17, name: "Error en el proceso térmico (autoclave)", desc: "Riesgo microbiológico severo.", prob: 2, imp: 5, plan: "Automatización, validación térmica, alarmas HACCP." },
            { id: 18, name: "Errores en etiquetado o codificación del lote", desc: "Pérdida de trazabilidad, sanciones INVIMA.", prob: 3, imp: 4, plan: "Etiquetado digital, revisión cruzada, escáneres." },
            { id: 19, name: "Error en programación de inventarios (no aplicar FIFO)", desc: "Producto vencido o deteriorado.", prob: 3, imp: 3, plan: "ERP, auditorías de inventario, capacitación logística." },
            { id: 20, name: "Error en recepción de materia prima", desc: "Ingreso de producto fuera de especificaciones.", prob: 3, imp: 4, plan: "Protocolos de inspección, hojas técnicas, rechazo documentado." },
            { id: 21, name: "Error en despacho (producto equivocado o mal cargado)", desc: "Retrasos, devoluciones, insatisfacción del cliente.", prob: 4, imp: 3, plan: "Checklists, supervisión, escaneo RFID." },
            { id: 22, name: "Mala manipulación del producto en almacén", desc: "Latas abolladas, contaminación o pérdidas.", prob: 3, imp: 3, plan: "Capacitación en manipulación, rutas internas señalizadas." },
            { id: 23, name: "Error administrativo (orden mal digitada)", desc: "Sobreproducción o faltantes.", prob: 3, imp: 3, plan: "Doble verificación, formularios automatizados." }
        ];

        // --- RENDERIZADO RIESGOS ---
        const heatmapEl = document.getElementById('risk-heatmap');
        const listEl = document.getElementById('risk-list-container');

        for (let p = 5; p >= 1; p--) {
            for (let i = 1; i <= 5; i++) {
                const cell = document.createElement('div');
                cell.className = 'heat-cell';
                const riskVal = p * i;
                let colorCode = riskVal >= 15 ? '#ff453a' : (riskVal >= 8 ? '#ff9f0a' : (riskVal >= 4 ? '#ffd60a' : '#32d74b'));
                cell.style.backgroundColor = colorCode;
                const itemsInCell = riskData.filter(r => r.prob === p && r.imp === i);
                if (itemsInCell.length > 0) {
                    cell.innerHTML = `<span class="bg-black/40 text-white rounded-full w-5 h-5 flex items-center justify-center text-[10px] backdrop-blur-sm border border-white/20">${itemsInCell.length}</span>`;
                    cell.title = itemsInCell.map(r => r.name).join(', ');
                }
                heatmapEl.appendChild(cell);
            }
        }

        riskData.forEach(r => {
            const el = document.createElement('div');
            el.className = 'risk-item';
            let borderColor = '#32d74b'; 
            const val = r.prob * r.imp;
            if(val >= 15) borderColor = '#ff453a';
            else if(val >= 8) borderColor = '#ff9f0a';
            else if(val >= 4) borderColor = '#ffd60a';
            el.style.borderLeftColor = borderColor;
            el.innerHTML = `
                <div class="flex justify-between items-start mb-1">
                    <span class="text-sm font-bold text-white max-w-[80%]">${r.id}. ${r.name}</span>
                    <span class="text-[10px] opacity-70 whitespace-nowrap">P:${r.prob} I:${r.imp}</span>
                </div>
                <p class="text-xs text-gray-400 mb-2 leading-relaxed">${r.desc}</p>
                <div class="text-[10px] text-gray-500 bg-white/5 p-2 rounded">
                    <strong class="text-gray-400">Plan:</strong> ${r.plan}
                </div>`;
            listEl.appendChild(el);
        });

        // --- 1. THREE.JS SETUP ---
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x050505, 0.035);
        const camera = new THREE.PerspectiveCamera(35, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.set(0, 0, 10);
        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true, powerPreference: "high-performance" });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // --- 2. ASSETS & GEOMETRY ---
        function createMetalTex() {
            const c = document.createElement('canvas'); c.width=256; c.height=256;
            const x = c.getContext('2d'); x.fillStyle='#999'; x.fillRect(0,0,256,256);
            for(let i=0; i<10000; i++) { x.fillStyle = Math.random()>0.5?'#aaa':'#888'; x.fillRect(Math.random()*256, Math.random()*256, 2, 1); }
            return new THREE.CanvasTexture(c);
        }
        function createHoloLabel() {
            const c = document.createElement('canvas'); c.width=1024; c.height=512;
            const x = c.getContext('2d');
            const grd = x.createLinearGradient(0,0,0,512);
            grd.addColorStop(0, '#001a33'); grd.addColorStop(1, '#001a33');
            x.fillStyle = grd; x.fillRect(0,0,1024,512);
            x.strokeStyle = 'rgba(41, 151, 255, 0.2)'; x.lineWidth=1;
            for(let i=0; i<1024; i+=40) { x.beginPath(); x.moveTo(i,0); x.lineTo(i,512); x.stroke(); }
            x.fillStyle = '#b8860b'; x.fillRect(0, 450, 1024, 20);
            x.fillStyle='#fff'; x.font="900 80px Arial"; x.fillText("ATÚN ENLATADO", 50, 150);
            x.fillStyle='#ccc'; x.font="20px monospace"; x.fillText("PESO NETO: 170g", 50, 420);
            const t = new THREE.CanvasTexture(c); t.anisotropy=16; return t;
        }
        
        // --- REALISTIC MEAT TEXTURE ---
        function createMeatTexture() {
            const c = document.createElement('canvas'); c.width=512; c.height=512;
            const x = c.getContext('2d'); 
            x.fillStyle='#ff7070'; x.fillRect(0,0,512,512);
            for(let i=0; i<100000; i++) { 
                const val = Math.random();
                x.fillStyle = val > 0.7 ? '#ff9999' : (val < 0.3 ? '#cc5555' : '#ff6666'); 
                x.beginPath(); 
                x.ellipse(Math.random()*512, Math.random()*512, 1, 3, Math.random()*Math.PI, 0, Math.PI*2);
                x.fill(); 
            }
            return new THREE.CanvasTexture(c);
        }
        
        // --- WOOD TEXTURE ---
        function createWoodTex() {
            const c = document.createElement('canvas'); c.width=512; c.height=512;
            const x = c.getContext('2d'); 
            x.fillStyle='#8B4513'; x.fillRect(0,0,512,512);
            for(let i=0; i<5000; i++) {
                x.fillStyle = Math.random()>0.5?'#A0522D':'#D2691E';
                x.fillRect(Math.random()*512, Math.random()*512, Math.random()*100, 2);
            }
            return new THREE.CanvasTexture(c);
        }
        
        // --- CORRUGATED METAL TEXTURE ---
        function createCorrugatedTex() {
            const c = document.createElement('canvas'); c.width=512; c.height=512;
            const x = c.getContext('2d');
            x.fillStyle='#003366'; x.fillRect(0,0,512,512); // Base blue
            for(let i=0; i<512; i+=20) {
                // Shadow/Highlight for corrugation
                const grad = x.createLinearGradient(i,0,i+20,0);
                grad.addColorStop(0, '#002244');
                grad.addColorStop(0.5, '#004488');
                grad.addColorStop(1, '#002244');
                x.fillStyle = grad;
                x.fillRect(i,0,20,512);
            }
            return new THREE.CanvasTexture(c);
        }

        const mainGroup = new THREE.Group(); scene.add(mainGroup);
        const metalMat = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.3, metalness: 0.8, bumpMap: createMetalTex(), bumpScale: 0.005 });
        metalMat.emissive = new THREE.Color(0x000000); 
        const meatMat = new THREE.MeshStandardMaterial({ map: createMeatTexture(), roughness: 0.6, color: 0xffcccc });
        const woodMat = new THREE.MeshStandardMaterial({ map: createWoodTex(), roughness: 0.9 });
        const containerMat = new THREE.MeshStandardMaterial({ map: createCorrugatedTex(), roughness: 0.6, metalness: 0.4 });

        // GROUPS
        const canGroup = new THREE.Group();
        const bodyGroup = new THREE.Group(); 
        
        const canBody = new THREE.Mesh(new THREE.CylinderGeometry(0.99, 0.99, 1.0, 64), metalMat); canBody.castShadow = true;
        const rimTop = new THREE.Mesh(new THREE.TorusGeometry(1, 0.03, 16, 64), metalMat); rimTop.position.y = 0.5; rimTop.rotation.x = Math.PI/2;
        const rimBot = new THREE.Mesh(new THREE.TorusGeometry(1, 0.03, 16, 64), metalMat); rimBot.position.y = -0.5; rimBot.rotation.x = Math.PI/2;
        
        // Meat filled almost to top
        const meat = new THREE.Mesh(new THREE.CylinderGeometry(0.97, 0.97, 0.92, 32), meatMat);
        meat.position.y = 0.02; 
        
        const lidGroup = new THREE.Group();
        const lid = new THREE.Mesh(new THREE.CylinderGeometry(0.98, 0.98, 0.02, 64), metalMat);
        const tabGroup = new THREE.Group();
        const tabRing = new THREE.Mesh(new THREE.TorusGeometry(0.1, 0.015, 16, 32), metalMat); tabRing.rotation.x = Math.PI/2; tabRing.position.x = 0.35;
        const tabBase = new THREE.Mesh(new THREE.BoxGeometry(0.25, 0.01, 0.12), metalMat); tabBase.position.x = 0.15;
        tabGroup.add(tabRing, tabBase); tabGroup.position.set(0, 0.05, 0); tabGroup.rotation.y = 0.5;
        lidGroup.add(lid, tabGroup); lidGroup.position.y = 0.5; 

        bodyGroup.add(canBody, rimTop, rimBot, meat);
        
        // --- PEELABLE LABEL LOGIC (RESTORED MAIN.HTML MATH) ---
        const segW = 80; const segH = 1;
        const labelGeo = new THREE.PlaneGeometry(Math.PI * 2.05, 0.92, segW, segH);
        const labelMat = new THREE.MeshStandardMaterial({ map: createHoloLabel(), transparent: true, side: THREE.DoubleSide, roughness: 0.4, metalness: 0.2 });
        const labelMesh = new THREE.Mesh(labelGeo, labelMat);
        
        const basePos = labelGeo.attributes.position.clone();

        function updateLabel(val) {
            const pos = labelGeo.attributes.position;
            const radius = 1.01;
            
            // STRICT RESET
            if(val <= 0.001) {
                // Map plane to cylinder purely
                for(let i=0; i < pos.count; i++) {
                    const u = (i % (segW + 1)) / segW;
                    const angle = u * Math.PI * 2 + Math.PI; 
                    const y = basePos.getY(i);
                    pos.setXYZ(i, Math.sin(angle) * radius, y, Math.cos(angle) * radius);
                }
                pos.needsUpdate = true;
                labelGeo.computeVertexNormals();
                return;
            }

            // PEEL LOGIC (Main.html style)
            const peelStart = THREE.MathUtils.lerp(1.0, 0.5, val); // Peel threshold
            
            for(let i=0; i < pos.count; i++) {
                const u = (i % (segW + 1)) / segW; // 0 to 1
                const angle = u * Math.PI * 2 + Math.PI;
                const yBase = basePos.getY(i);
                
                let x, z, y;
                
                if (u < peelStart) {
                    x = Math.sin(angle) * radius;
                    z = Math.cos(angle) * radius;
                    y = yBase;
                } else {
                    const hingeU = peelStart;
                    const hingeAngle = hingeU * Math.PI * 2 + Math.PI;
                    const dist = (u - peelStart) * 4 * val;
                    
                    const tanX = Math.cos(hingeAngle); 
                    const tanZ = -Math.sin(hingeAngle);
                    const hX = Math.sin(hingeAngle) * radius;
                    const hZ = Math.cos(hingeAngle) * radius;
                    
                    x = hX + tanX * dist + (Math.cos(hingeAngle)*dist*0.2);
                    z = hZ + tanZ * dist - (Math.sin(hingeAngle)*dist*0.2);
                    y = yBase + Math.sin(dist*2)*0.2*val;
                }
                
                pos.setXYZ(i, x, y, z);
            }
            pos.needsUpdate = true;
            labelGeo.computeVertexNormals();
        }
        updateLabel(0); 

        // Label must be child of bodyGroup to explode with it later
        bodyGroup.add(labelMesh);

        canGroup.add(bodyGroup, lidGroup);
        canGroup.position.set(-2.2, 0, 1.5);
        canGroup.scale.set(1.2, 1.2, 1.2);
        mainGroup.add(canGroup);

        // --- NEW OBJECTS FOR SECTION 4 ---
        
        // PALLET
        const palletGroup = new THREE.Group();
        // Runners
        const runnerGeo = new THREE.BoxGeometry(0.2, 0.3, 4);
        const r1 = new THREE.Mesh(runnerGeo, woodMat); r1.position.set(-1.5, 0, 0);
        const r2 = new THREE.Mesh(runnerGeo, woodMat); r2.position.set(0, 0, 0);
        const r3 = new THREE.Mesh(runnerGeo, woodMat); r3.position.set(1.5, 0, 0);
        palletGroup.add(r1, r2, r3);
        // Boards
        const boardGeo = new THREE.BoxGeometry(4, 0.1, 0.4);
        for(let i=0; i<7; i++) {
            const b = new THREE.Mesh(boardGeo, woodMat);
            b.position.set(0, 0.2, -1.8 + i*0.6);
            palletGroup.add(b);
        }
        palletGroup.position.set(0, -20, 0); // Hide init
        mainGroup.add(palletGroup);

        // CONTAINER (20ft Metaphor)
        // Scaled down to 0.85 as requested
        const containerGroup = new THREE.Group();
        containerGroup.scale.set(0.85, 0.85, 0.85); // Scale applied here
        // Floor
        const floor = new THREE.Mesh(new THREE.BoxGeometry(7, 0.2, 10), containerMat);
        floor.position.y = -0.5;
        // Roof
        const roof = new THREE.Mesh(new THREE.BoxGeometry(7, 0.2, 10), containerMat);
        roof.position.y = 6.5;
        // Left Wall
        const lWall = new THREE.Mesh(new THREE.BoxGeometry(0.2, 7, 10), containerMat);
        lWall.position.set(-3.5, 3, 0);
        // Back Wall
        const bWall = new THREE.Mesh(new THREE.BoxGeometry(7, 7, 0.2), containerMat);
        bWall.position.set(0, 3, -5);
        
        containerGroup.add(floor, roof, lWall, bWall);
        containerGroup.position.set(0, -20, 0); // Hide init
        mainGroup.add(containerGroup);


        // RACK (Sec 3)
        const rackGroup = new THREE.Group();
        const rackMat = new THREE.MeshStandardMaterial({ color: 0xe67e22, roughness: 0.7 }); 
        const postGeo = new THREE.BoxGeometry(0.15, 6, 0.15);
        const shelfGeo = new THREE.BoxGeometry(4.2, 0.1, 1.5);
        const boxGeo = new THREE.BoxGeometry(0.8, 0.6, 0.8);
        const boxMat = new THREE.MeshStandardMaterial({ color: 0x8d6e63 });

        const rp1 = new THREE.Mesh(postGeo, rackMat); rp1.position.set(-2, 0, -1);
        const rp2 = new THREE.Mesh(postGeo, rackMat); rp2.position.set(2, 0, -1);
        const rshelf = new THREE.Mesh(shelfGeo, rackMat); rshelf.position.set(0, -0.65, -1);
        
        const box1 = new THREE.Mesh(boxGeo, boxMat); box1.position.set(-1.2, -0.25, -1);
        const box2 = new THREE.Mesh(boxGeo, boxMat); box2.position.set(0, -0.25, -1);
        const box3 = new THREE.Mesh(boxGeo, boxMat); box3.position.set(1.2, -0.25, -1);

        rackGroup.add(rp1, rp2, rshelf, box1, box2, box3); 
        rackGroup.position.set(0, -20, 0); 
        mainGroup.add(rackGroup);

        // LIGHTS
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.2); scene.add(ambientLight);
        const spotLight = new THREE.SpotLight(0xffffff, 5); spotLight.position.set(5, 5, 5); spotLight.castShadow = true; scene.add(spotLight);
        const coloredLight = new THREE.PointLight(0x2997ff, 0, 10); coloredLight.position.set(-3, 2, 2); scene.add(coloredLight);

        // --- 5. ANIMATION (GSAP) ---
        gsap.registerPlugin(ScrollTrigger);

        gsap.utils.toArray('.content-panel').forEach(panel => {
            gsap.to(panel, { opacity: 1, y: 0, duration: 0.5, scrollTrigger: { trigger: panel.parentElement, start: "top 60%", end: "bottom 40%", toggleActions: "play reverse play reverse" } });
        });

        const tl = gsap.timeline({ scrollTrigger: { trigger: "#scroll-wrapper", start: "top top", end: "bottom bottom", scrub: 1.2 } });
        const peelObj = { val: 0 };

        // 1. PRODUCTO (Lata Abre + Etiqueta Pela Parcialmente)
        tl.to(canGroup.position, { x: 2.8, y: 0, z: 1 }, 0.6) 
          .to(canGroup.scale, { x: 1, y: 1, z: 1 }, 0.6)
          .to(canGroup.rotation, { x: 0.5, y: -0.5, z: 0 }, 0.6) 
          .to(lidGroup.rotation, { x: -Math.PI / 1.5 }, 0.6) // Open Lid
          .to(lidGroup.position, { y: 1.2, z: -0.5 }, 0.6)
          .to(peelObj, { val: 0.4, onUpdate: () => updateLabel(peelObj.val) }, 0.6); // Start peel

        // 2. HISTAMINA (Cierra Tapa, Pela Full, Roja)
        tl.to(canGroup.position, { x: -2.8, y: 0, z: 1 }, 1.6) 
          .to(lidGroup.rotation, { x: 0 }, 1.6) // Close Lid
          .to(lidGroup.position, { y: 0.5, z: 0 }, 1.6)
          .to(canGroup.rotation, { x: 0, y: 0, z: 0 }, 1.6)
          .to(peelObj, { val: 0.8, onUpdate: () => updateLabel(peelObj.val) }, 1.6) // Full Peel
          .to(coloredLight, { intensity: 8 }, 1.6)
          .to(coloredLight.color, { r: 1, g: 0.2, b: 0.2 }, 1.6)
          .to(metalMat.emissive, { r: 0.5, g: 0, b: 0 }, 1.6);

        // 3. FEFO (Cierra Etiqueta, Rota a Rack)
        tl.to(canGroup.position, { x: 2.8, y: 0.5, z: 0 }, 2.2) 
          .to(peelObj, { val: 0, onUpdate: () => updateLabel(peelObj.val) }, 2.2) // Close Label
          .to(metalMat.emissive, { r: 0, g: 0, b: 0 }, 2.2) 
          .to(canGroup.rotation, { z: Math.PI/2, y: 0, x: 0 }, 2.2) 
          .to(rackGroup.position, { x: 2.5, y: 0, z: 0 }, 2.2) 
          .to(coloredLight.color, { r: 1, g: 0.6, b: 0 }, 2.2); 

        // 4. TRANSPORTE (New: Pallet + Container)
        tl.to(rackGroup.position, { y: -20 }, 3.2) // Hide Rack
          .to(palletGroup.position, { x: -2.0, y: -1, z: 0 }, 3.2) // Show Pallet Left
          .to(canGroup.position, { x: -2.0, y: 0.2, z: 0 }, 3.2) // Can on Pallet
          .to(canGroup.rotation, { z: 0, y: 0, x: 0 }, 3.2) // Reset Can rotation to upright
          .to(containerGroup.position, { x: -2.0, y: -1, z: 0 }, 3.2) // Show Container around
          .to(coloredLight.color, { r: 0.2, g: 0.5, b: 1 }, 3.2); // Blue Light

        // 5. SERVICIO AL CLIENTE (NUEVA ESCENA)
        // Lata al centro, flotando, iluminada en dorado
        tl.to(palletGroup.position, { y: -20 }, 4.2)
          .to(containerGroup.position, { y: -20 }, 4.2)
          .to(canGroup.position, { x: 0, y: 0, z: 1.5 }, 4.2)
          .to(canGroup.rotation, { z: 0, y: 0.5, x: 0.2 }, 4.2)
          .to(coloredLight.color, { r: 1, g: 0.8, b: 0.2 }, 4.2); // Dorado

        // 6. RIESGOS (Hide All)
        tl.to(canGroup.position, { x: 0, y: -15, z: -5 }, 5.4)
          .to(coloredLight.color, { r: 0.8, g: 0.2, b: 1 }, 5.4); // Morado

        // 7. FINAL
        tl.to(canGroup.position, { x: 0, y: 0, z: 2.5 }, 6.6)
          .to(canGroup.rotation, { x: 0.5, y: 0, z: 0 }, 6.6)
          .to(coloredLight.color, { r: 1, g: 0.8, b: 0.2 }, 6.6);

        function animate() {
            requestAnimationFrame(animate);
            if (!gsap.isTweening(canGroup.rotation)) canGroup.rotation.y += 0.002;
            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        const sections = document.querySelectorAll('.scroll-section');
        const dots = document.querySelectorAll('.dot');
        
        window.addEventListener('scroll', () => {
             let current = '';
             const scrollY = window.scrollY;
             const h = window.innerHeight;
             sections.forEach((sec, i) => { const top = sec.offsetTop; if(scrollY >= top - h/3) current = i; });
             dots.forEach((dot, i) => { if(i === current) dot.classList.add('active'); else dot.classList.remove('active'); });
             
             const statusTxt = document.getElementById('status-text');
             const statusInd = document.getElementById('status-indicator');
             if(current === 2) { 
                 statusTxt.innerText = "ALERTA TÉRMICA"; statusTxt.style.color = "#ff453a";
                 statusInd.classList.remove('bg-brand-blue'); statusInd.classList.add('bg-brand-red');
             } else if (current === 6) { // Ajustado a índice 6 (Riesgos)
                 statusTxt.innerText = "RIESGO DETECTADO"; statusTxt.style.color = "#bf5af2";
                 statusInd.classList.remove('bg-brand-blue', 'bg-brand-red'); statusInd.classList.add('bg-purple-500');
             } else {
                 statusTxt.innerText = "ONLINE"; statusTxt.style.color = "#fff";
                 statusInd.classList.add('bg-brand-blue'); statusInd.classList.remove('bg-brand-red', 'bg-purple-500');
             }
        });

        window.onload = () => {
            setTimeout(() => {
                document.getElementById('loader').style.opacity = 0;
                setTimeout(() => {
                    document.getElementById('loader').style.display = 'none';
                    animate();
                    ScrollTrigger.refresh();
                }, 800);
            }, 1000);
        };
        window.scrollToSec = (idx) => { const sec = document.getElementById(`sec-${idx}`); window.scrollTo({ top: sec.offsetTop, behavior: 'smooth' }); }
    </script>
</body>
</html>
